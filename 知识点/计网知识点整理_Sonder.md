# 计算机网络期末复习重点笔记

## 零、 基础概念与体系结构

### 1. 计算机网络基础

* **三大共享**：

  1. 硬件共享
  2. 软件共享
  3. 信息共享
* **四大时延**：

  * 发送时延（传输时延）
  * 传播时延
  * 处理时延
  * 排队时延
* **协议与服务**：

  * **协议**：水平的（控制对等实体通信）。
  * **服务**：垂直的（下层向上层提供服务）。
* **协议的三要素**：

  1. **语法**：数据格式、编码方式、信号电平（怎么写）。
  2. **语义**：控制信息、错误处理、动作响应（做什么）。
  3. **同步（时序）**：速度匹配、排序（什么时候做）。
* **常见的三种计算机网络体系结构**：

  1. **OSI 七层模型**：(物理层、数据链路层)、网络层、运输层、(表示层、会话层)、应用层。
  2. **TCP/IP 四层模型**：网络接口层、网络层、运输层、应用层。
  3. **五层模型**：(物理层、数据链路层)、网络层、运输层、应用层。

  * 详情见湖科大映射图

### 2. 网络适配器 (NIC)

* 体现了 **物理层** 和 **数据链路层** 的功能。

---

## 一、 物理层 (Physical Layer)

### 1. 四大特性

* **机械特性**：接口形状、引脚数目（例：RJ45接口形状）。
* **电气特性**：电压范围（例：-5V到+5V）。
* **功能特性**：电平意义（例：高电平代表1）。
* **过程特性**（规程特性）：事件发生的顺序。

### 2. 编码方式

* **曼彻斯特编码**：
  * **特点**：位周期中心向上或向下跳变。
  * **定义**：跳变方向代表0或1（标准不同定义不同，如IEEE 802.3规定低到高为1，高到低为0，反之亦然）。
* **差分曼彻斯特编码**：
  * **特点**：位中心始终跳变（用于同步）。
  * **定义**：**位开始边界**有跳变代表0，无跳变代表1（即“遇0翻转，遇1不变”）。

### 3. 极限传输速率计算 (必考)

* **奈氏准则 (无噪声环境)**
  * $$
    C = 2W \log_2 V
    $$
  * 变形：

    $$
    C = R \log_2 V
    $$

    （其中 $R$ 为波特率/码元速率，$R=2W$）。
  * **注意单位**：$W$ (Hz), $C$ (bit/s), $R$ (Baud)。
* **香农公式 (有噪声环境)**
  * $$
    C = W \log_2(1 + S/N)
    $$
  * **信噪比转换**：
    $$
    dB = 10 \log_{10}(S/N)
    $$
  * *速算提示*：$\log_2(1001) \approx 10$。

### 4. 信道复用技术

* **FDM** (Frequency): 频分复用
* **TDM** (Time): 时分复用
* **STDM** (Statistical): 统计时分复用（按需动态分配，效率更高）
* **WDM** (Wavelength): 波分复用（光的频分复用）
* **CDM** (Code): 码分复用（CDMA）

### 5. 宽带接入技术

* **xDSL**：基于电话线（ADSL）。
* **FTTx**：光纤接入。
  * **FTTH**：光纤到户 (Home)。

### 6. 物理层设备

* **中继器、集线器 (Hub)**：
  * **缺点**：广播发送，扩大冲突域，**带宽平分**（如10Mb/s连接10个设备，每台设备平均1Mb/s）。
  * **限制**：不能连接不同速率的设备。

### 7. 传输媒体与标准 (补充)

* **10Base-T**: 双绞线 (Twisted Pair)，Baseband (基带)。
* **10Base-F**: 光纤 (Fiber)，后缀 F 代表 Fiber。
* **判别方法**: 看后缀，T为双绞线，F为光纤。
* **同轴电缆**: 早期使用，现已少见。

---

## 二、 数据链路层 (Data Link Layer)

### 1. 三个基本问题

* **封装成帧**：添加首部尾部，帧定界。
  * **数据单位**：应用层(报文 Message) -> 运输层(报文段 Segment) -> 网络层(分组/包 Packet) -> 链路层(帧 Frame)。
  * **可靠性**：有确认重传机制为“可靠传输”；无确认为“不可靠传输” (如Ethernet)。
  * **相邻节点流量控制**：链路层的流量控制是点对点/相邻节点的 (区别于运输层端到端)。
* **透明传输**：
  * **PPP协议 (字节填充法)**：
    * 转义符：`0x7D`。
    * 发送：见到 `7E` $\rightarrow$ `7D 5E`；见到 `7D` $\rightarrow$ `7D 5D`。
    * 接收（还原）：去掉 `7D`，后一字节与 `0x20` 异或。
  * **HDLC协议 (零比特填充法)**：
    * 发送：只要发现5个连续的1，立即填入一个0。
    * 接收：发现5个连续1，删除后面的0。
* **差错控制**：
  * **CRC 循环冗余校验**：计算余数时，被除数需先左移（加0），位数等于生成多项式最高次幂。
    * 也就是先加最高次幂个0在右边
  * *注意*：数据链路层通常提供**无差错接受**（丢弃错帧），要实现“可靠传输”通常需配合确认重传机制。

### 2. 以太网 (Ethernet)

* **技术核心**：CSMA/CD (载波监听多点接入/碰撞检测)。
  * **随机接入的共享信道技术**，半双工通信。
  * **CSMA/CD 细节**：
    * **帧间隔**：96比特时间 (Interframe Gap) — 发送后需等待的时间。
      * 第六次课测试题目6
    * **退避算法**：二进制指数退避算法 (计算重传时间)。
* **MAC地址**：
  * 固化在ROM中。
  * 长度48位（6字节），目的MAC地址在帧的最前面。
* **最短帧长与争用期**：
  * **原理**：必须在发送完一帧之前能检测到碰撞（发送时延 $\ge$ 往返传播时延 RTT）。
  * **10Mb/s 以太网**：争用期 $51.2\mu s$，最短帧长 **64B (512bit)**。
  * **100Mb/s 以太网**：争用期 $5.12\mu s$，最短帧长 **64B (512bit)**。
  * *细节*：以太网帧前有8字节（7字节前导码+1字节帧定界符），但不计入MAC帧长度。

### 3. 交换机 (Switch)

* **工作原理**：
  * **构建转发表**：根据帧的**源MAC地址**学习（记录源MAC与接口映射）。
  * **转发决策**：根据帧的**目的MAC地址**查找转发表转发（PDU）。
* **直通交换**：只接收到目的MAC地址（前6字节）就开始转发。延迟计算 = 6字节 / 带宽。
  * 大题给一个抓包的数据字节流,要知道MAC,IP等结构,找目的IP/MAC地址,还有多播什么的判断类型
* **冲突域**：交换机隔离冲突域，路由器隔离广播域。

---

## 三、 网络层 (Network Layer)

### 1. IP 协议基础

* **IP 数据报主要字段**：
  * **版本 (Version)**：4位，IPv4 (4) 或 IPv6 (6)。
  * **首部长度 (IHL)**：4位，单位是 **4字节** (最大 60B)。
  * **协议 (Protocol)**：8位，指出数据部分是哪个协议。
    * `6`: TCP
    * `17`: UDP
    * `1`: ICMP
    * `89`: OSPF
    * `2`: IGMP

* **首部长度**：
  * 单位是 **4字节**。
  * 常用值 `5`，代表首部长度 $5 \times 4 = 20$ 字节。
* **校验和**：
  * **IP**：只校验首部（因为TTL每跳都在变，数据部分不校验以提高效率）。
  * **首部校验和 (Header Checksum) 计算步骤**：
    1. **发送方 (计算)**：
       * 将首部划分为 16位 (2字节) 的序列。
       * 校验和字段暂置为 0。
       * 对所有序列进行 **反码算术求和** (二进制求和，最高位产生/即大于16位的 进位 加到最低位)。
       * 将求和结果 **取反 (取反码)**，填入校验和字段。
    2. **接收方 (验证 - 逆过程)**：
       * 将首部 (包含已填充的校验和) 再次进行 **反码算术求和**。
       * **结果判定**：结果应为全 1 (即 16进制 `FFFF`，二进制反码的 -0)。
       * 若结果为 0 (或其他值)，则说明出错，丢弃。
    * *记忆口诀*：发送方“求和取反”，接收方“求和全1”。
    * 上课习题4.7
* **分片**：
  * 数据报切分长度必须是 **8字节** 的倍数（片偏移字段单位是8字节）。
    * 上课习题4.6
* **可用 IP 地址计算**：
  * **范围**：地址范围去掉**首部** (通常指网络前缀/网络号部分) 和 **尾部** (广播地址) 就是可用地址。
  * **数量**：$2^k - 2$ ($k$ 为主机号位数)。

### 2.5 路由器与交换技术 (补充)

* **路由器结构**：
  * **控制层面**：路由选择 (Routing) — 生成路由表 (软件实现，慢)。
  * **数据层面**：分组转发 (Forwarding) — 根据转发表转发 (硬件实现，快)。
* **交换方式**：
  * **面向连接**：虚电路 (Virtual Circuit) — 建立逻辑连接，保证顺序。
  * **无连接**：数据报 (Datagram) — 独立路由，不保证顺序 (IP采用)。

### 2. IP 地址分类

* **A类**：`1 ~ 126` (0xxxxxxx)
* **B类**：`128 ~ 191` (10xxxxxx)
* **C类**：`192 ~ 223` (110xxxxx)
* **D类**：`224 ~ 239` (1110xxxx，多播地址)
* **专用 (私有) IP 地址**：
  * `10.0.0.0` - `10.255.255.255`
  * `172.16.0.0` - `172.31.255.255`
  * `192.168.0.0` - `192.168.255.255`

### 3. 路由协议 (重点)

* **RIP (内部网关 IGP)**：
  * 基于距离向量。
  * 使用 **UDP** 传送 (端口520)。
  * 特点：“好消息传得快，坏消息传得慢” (计数到无穷)。
  * **路由更新逻辑**：若B原有 `(N1, 3, C)`，收到C发来的 `(N1, 9)` [意味着C到N1变成了9]，则必须更新为 `(N1, 10, C)` [因为B的下一跳是C，必须无条件信服C的变动]。
* **OSPF (内部网关 IGP)**：
  * 基于链路状态。
  * 直接使用 **IP** 数据报传送 (协议号89)。
* **BGP (外部网关 EGP)**：
  * 路径向量路由。
  * 使用 **TCP** 传送 (端口179)。
  * **eBGP** (外部)、**iBGP** (内部)。
    * eBGP:边界网关用,external
    * iBGP:内部网关用,internal
  * 策略：“热土豆路由” (尽快将包扔出AS)。

### 4. 其他协议

* **ARP**：解决IP到MAC的映射。
* **ICMP**：PING 命令使用该协议（回送请求/回答）。
* **IGMP**：网际组管理协议（用于多播）。
* **NAT**：网络地址转换（解决IPv4短缺，私网转公网）。

### 5. IPv6

* 地址长度：128位（16字节），十六进制表示 (8组 x 4位)。
* **零压缩**：一连串的0可用 `::` 代替，但只能用一次。
  * 例：还原 `0123::1:2` $\rightarrow$ `0123:0000:0000:0000:0000:0000:0001:0002`。

---

## 四、 运输层 (Transport Layer)

### 1. UDP vs TCP

* **核心区别**：
  * **网络层**：提供**主机到主机 (Host-to-Host)** 的逻辑通信。
  * **运输层**：提供**进程到进程 (Process-to-Process / End-to-End)** 的逻辑通信。
  * **流量控制**：运输层是端到端的流量控制。

| 特性       | UDP                  | TCP                          |
| :--------- | :------------------- | :--------------------------- |
| **连接**   | 无连接               | 面向连接                     |
| **可靠性** | 不可靠               | 可靠 (确认、重传)            |
| **报文**   | 面向报文             | 面向字节流                   |
| **校验和** | 首部+数据+**伪首部** | 首部+数据+**伪首部**         |
| **应用**   | DNS, RIP, TFTP, DHCP | FTP, HTTP, SMTP, Telnet, BGP |

* **伪首部 (Pseudo Header)**：
  * **作用**：检查数据是否到达了正确的IP地址，防止误投。
  * **内容**：源IP、目的IP、0、协议号(17/6)、UDP/TCP长度 (共12字节)。
  * **注意**：伪首部**不**向下传送，也不在网络上传输，仅用于计算校验和。
* **UDP 数据报格式** (一共 8 字节首部)：
  * `源端口 (2B)` | `目的端口 (2B)` | `长度 (2B)` | `校验和 (2B)`
  * **长度字段**：包含 **首部 + 数据** 的总长度 (最小值 8)。
  * **校验范围**：**首部 + 伪首部 + 数据部分** (不同于 IP 只验首部)。

### 2. TCP 核心机制

* **三次握手状态 (详细)**：
  * **服务器**：`CLOSED` -> `LISTEN` -> `SYN-RCVD` -> `ESTABLISHED`。
  * **客户端**：`CLOSED` -> `SYN-SENT` -> `ESTABLISHED`。
* **四次挥手状态 (详细)**：
  * **ESTABLISHED** -> `FIN-WAIT-1` -> `FIN-WAIT-2` -> `TIME-WAIT` (2MSL) -> `CLOSED`。
  * **服务器**：`CLOSE-WAIT` -> `LAST-ACK` -> `CLOSED`。
  * *特殊状态*：`CLOSING` (双方同时关闭)。
* **RTO (超时重传时间) 计算** (必考)：
  * 公式：$RTO = RTT_S + 4 \times RTT_D$
  * **(1) 首次测量** ($RTT_{new}$)：
    * $RTT_S = RTT_{new}$
    * $RTT_D = RTT_{new} / 2$
    * $RTO = RTT_S + 4 \times RTT_D$
  * **(2) 后续测量** ($RTT_{new}$)：
    * $RTT_{D\_new} = (1 - \beta) \times RTT_{D\_old} + \beta \times |RTT_{new} - RTT_{S\_old}|$
    * $RTT_{S\_new} = (1 - \alpha) \times RTT_{S\_old} + \alpha \times RTT_{new}$
    * $RTO = RTT_{S\_new} + 4 \times RTT_{D\_new}$
    * $RTO = RTT_{S\_new} + 4 \times RTT_{D\_new}$
* **性能指标**：
  * **发送时延**：数据长度 / 带宽。
  * **传播时延**：信道长度 / 电磁波速率。
  * **RTT (往返时间)**：并不包括发送时延，仅包含传播时延+处理+排队 (有时候也包含发送，视题目定义，但通常RTT是往返传播)。
  * **吞吐率**：单位时间内通过的数据量。
  * **信道利用率**：有数据通过的时间 / 总时间。

---

## 五、 应用层 (Application Layer)

### 1. 域名系统 (DNS)

* 协议：基于 **UDP** (端口53)。
* 服务器：**本地域名服务器**（也称默认域名服务器）。
* 查询方式：
  * 主机 $\rightarrow$ 本地：**递归查询** (Recursive，类似函数调用返回结果)。
  * 本地 $\rightarrow$ 根/顶级：**迭代查询** (Iterative，类似由根指路，本地再去跑腿,for循环)。

### 2. 文件传输 (FTP & TFTP)

* **FTP (TCP)**：
  * **控制连接**：端口 **21** (持久连接)。
  * **数据连接**：端口 **20** (非持久连接，传完即断)。
* **TFTP (UDP)**：
  * 端口 **69**，简单文件传输。

### 3. 远程登录 (Telnet)

* 协议：基于 **TCP**。
* **NVT** (Network Virtual Terminal)：网络虚拟终端，屏蔽不同终端的差异。

### 3.5 DHCP 与 SMTP (补充)

* **DHCP (动态主机配置协议)**：
  * 基于 **UDP** (Client: 68, Server: 67)。
  * 作用：自动分配 IP 地址、子网掩码、网关等。
* **SMTP (简单邮件传输协议)**：
  * 基于 **TCP** (端口 25)。
  * 作用：发送邮件 (Push)。
  * 接收邮件通常用 **POP3** 或 **IMAP**。

### 4. 常见端口汇总

| 协议       | 端口  | 运输层 | 说明           |
| :--------- | :---- | :----- | :------------- |
| **FTP**    | 21/20 | TCP    | 21控制，20数据 |
| **SSH**    | 22    | TCP    | 安全远程登录   |
| **Telnet** | 23    | TCP    | 远程登录       |
| **SMTP**   | 25    | TCP    | 邮件发送       |
| **DNS**    | 53    | UDP    | 域名解析       |
| **DHCP**   | 67/68 | UDP    | 动态IP分配     |
| **TFTP**   | 69    | UDP    | 简单文件传输   |
| **HTTP**   | 80    | TCP    | 万维网         |
| **POP3**   | 110   | TCP    | 邮件接收       |

---

## 六、 实验与大题备考策略

1. **华为交换机/路由器命令**：
   * 复习 VLAN 划分命令。
   * 复习 端口 IP 配置命令。
   * 复习 静态路由配置命令。
   * *建议：将实验文档重点指令背诵。*
     * 这个文档喂给AI
2. **抓包分析**：
   * 给出一个十六进制数据流，能识别：
     * 前6字节是目的MAC，紧接6字节是源MAC。
     * 识别 IP 头部信息。
     * 识别 TCP/UDP 端口号。
3. **设备区分**：
   * **物理层**：集线器 (Hub)、中继器 (碰撞域不隔离，广播域不隔离)。
   * **数据链路层**：网桥、交换机 (隔离碰撞域，不隔离广播域)。
   * **网络层**：路由器 (隔离碰撞域，隔离广播域)。

---

## 七、 易混淆概念对比 (Exam Comparison)

### 1. 流量控制 (Flow Control) 对比

| 层次           | 范围                          | 实现机制                     | 备注                                                     |
| :------------- | :---------------------------- | :--------------------------- | :------------------------------------------------------- |
| **数据链路层** | **相邻节点** (Point-to-Point) | 停止-等待, 滑动窗口 (帧确认) | 控制两台直接相连设备间的发送速率，防止接收方 buffer 溢出 |
| **运输层**     | **端到端** (End-to-End)       | 滑动窗口 (rwnd)              | 控制发送主机与接收主机进程间的速率                       |

### 2. 校验和 (Checksum) 对比

| 协议            | 校验对象                 | 备注                                    |
| :-------------- | :----------------------- | :-------------------------------------- |
| **IP**          | **仅首部**               | 不校验数据部分 (为提高路由转发效率)     |
| **UDP/TCP**     | **首部 + 伪首部 + 数据** | 确保数据完整性及正确投递 (伪首部验证IP) |
| **MAC帧 (FCS)** | **整个帧** (首部+数据)   | 硬件CRC校验                             |

### 3. 可靠性对比

* **不可靠协议**：Ethernet, IP, UDP, DNS, RIP.
* **可靠协议**：TCP, SMTP, HTTP, FTP.
* *链路层*：通常 Ethernet 是不可靠的；Wireless (802.11) 有链路层确认 (ACK) 故有一定可靠性。

### 4. 报文格式与首部对比 (Packet/Frame Structure)

此部分为“自底向上”的封装视角，重点关注首部字节含义。

#### (1) 以太网 V2 MAC 帧 (链路层)

* **总长度**：64B ~ 1518B (数据 46~1500 + 首部 14 + 尾部 4)
* **结构**：
  * **前 6 字节**：**目的 MAC 地址**。
  * **后 6 字节**：**源 MAC 地址**。
  * **2 字节**：**类型** (Type) - (如 0x0800 代表 IP 数据报)。
  * **46 ~ 1500 字节**：**数据** (IP 数据报)。
  * **4 字节**：**FCS** (帧检验序列)。

#### (2) IP 数据报 (网络层)

* **首部长度**：固定 20 字节 + 可选部分。
* **前 20 字节固定部分 (按 4 字节每行记忆)**：
  1. **第 1-4 字节**：[版本(4b) + 首部长度(4b) + 服务类型(8b) + 总长度(16b)]
  2. **第 5-8 字节**：[标识(16b) + 标志(3b) + 片偏移(13b)]
  3. **第 9-12 字节**：[TTL(8b) + **协议**(8b) + **首部校验和**(16b)]
  4. **第 13-16 字节**：**源 IP 地址** (32b)。
  5. **第 17-20 字节**：**目的 IP 地址** (32b)。

#### (3) UDP 用户数据报 (运输层)

* **首部长度**：固定 8 字节。
* **结构**：
  * **第 1-2 字节**：**源端口**。
  * **第 3-4 字节**：**目的端口**。
  * **第 5-6 字节**：**长度** (含首部+数据)。
  * **第 7-8 字节**：**校验和**。

#### (4) TCP 报文段 (运输层)

* **首部长度**：固定 20 字节 + 选项。
* **前 20 字节固定部分**：
  1. **第 1-4 字节**：[源端口(16b) + 目的端口(16b)]
  2. **第 5-8 字节**：[**序号** (Seq) (32b)]
  3. **第 9-12 字节**：[**确认号** (Ack) (32b)]
   - 作用：期望收到对方下一个报文段的第一个数据字节的序号。若确认号为 $N$，则表示序号 $N-1$ 及以前的数据都已正确收到。
  4. **第 13-16 字节**：[数据偏移(4b) + 保留(6b) + **标志位**(6b) + **窗口**(16b)]
     * *标志位*：URG, ACK, PSH, RST, SYN, FIN.
     * 数据偏移作用：指出 TCP 报文段的数据起始处距离 TCP 报文段的起始处有多远。实际上就是指出 TCP 首部的长度。单位是 4 字节（32位字）。最大值为 15 ($15 \times 4 = 60$ 字节)，这也是 TCP 首部的最大长度。
     * 窗口: 进行流量控制的核心,"我的接收缓存还能容纳多少字节的数据"
  5. **第 17-20 字节**：[校验和(16b) + 紧急指针(16b)]


# 未分类

- OSPF优先级高于RIP
- TCP协议规定，当确认号为N时，表示（ ）。 期望收到序号为N的报文段
  - 累计确认机制
- 在TCP拥塞控制中，当发送方收到3个重复的ACK时，会采取（ ）快重传和快恢复

- * **(第三章)** PPP协议采用 **[字节]** 填充法（在异步链路）或 **[零比特]** 填充法（在同步链路）实现透明传输。

- * * **(第四章)** 一个B类IP地址的子网掩码是255.255.240.0，则该网络被划分为 **[16]** 个子网。
  - 不用减去2

-  ARP协议的作用是解决同一个局域网上的 **[IP]** 地址和 **[MAC]** 地址的映射问题。

- * **(第五章)** TCP报文段首部中，**[窗口]** 字段用来进行流量控制。

- 片偏移字段的单位是 8 字节 (8 Bytes)。