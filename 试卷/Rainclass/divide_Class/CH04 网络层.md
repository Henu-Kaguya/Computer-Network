# 第四章 网络层

### 4.1 填空题

网络层提供的两种服务，分别是面向连接的 [填空1] 服务和无连接的 [填空2] 服务。

**答案**：**虚电路；数据报**

> **解析：**
> 在计算机网络网络层的设计争论中（如 OSI 与 TCP/IP），主要有两种服务模型：
>
> * **虚电路 (Virtual Circuit)**：仿照电话网络，面向连接，保证顺序和可靠性（OSI 早期推崇）。
> * **数据报 (Datagram)**：IP 协议采用的模型，无连接，尽最大努力交付，不保证顺序和可靠性。

---

### 4.2 填空题

在网络互连的中继系统中，中继器处于 OSI/RM 的 [填空1] 层，网桥和交换机处于 [填空2] 层，路由器处于 [填空3] 层。

**答案**：**物理；数据链路；网络**

> **解析：**
>
> * **中继器 (Repeater) / 集线器 (Hub)**：只处理电信号的放大整形，工作在**物理层**。
> * **网桥 (Bridge) / 二层交换机 (Switch)**：基于 MAC 地址转发帧，工作在**数据链路层**。
> * **路由器 (Router)**：基于 IP 地址进行路由选择，工作在**网络层**。

---

### 4.3 填空题

试辨认以下 IP 地址的网络类别。
(1) 128.36.199.3 是 [填空1] 类地址
(2) 21.12.240.17 是 [填空2] 类地址
(3) 192.12.69.248 是 [填空3] 类地址
(4) 89.3.0.1 是 [填空4] 类地址
(5) 230.3.6.2 是 [填空5] 类地址

**答案**：**B；A；C；A；D**

> **解析：**
> 根据 IP 地址第一字节（十进制）的数值来判断类别：
>
> * **A类**：1 ~ 126
> * **B类**：128 ~ 191
> * **C类**：192 ~ 223
> * **D类**（组播）：224 ~ 239
> * **E类**（保留）：240 ~ 255
>
> 对应分析：
> (1) 128 在 B 类范围内。
> (2) 21 在 A 类范围内。
> (3) 192 在 C 类范围内。
> (4) 89 在 A 类范围内。
> (5) 230 在 D 类范围内。

---

### 4.4 单选题

网络 222.15.64.0/20 的地址范围是

* A. 222.15.64.0 ~ 222.15.79.255
* B. 222.15.64.0 ~ 222.15.64.255
* C. 222.15.64.0 ~ 222.15.127.255
* D. 222.15.0.0 ~ 222.15.255.255

**答案**：**A**

> **解析：**
>
> * **网络地址**：222.15.64.0
> * **子网掩码**：/20。这意味着前 20 位是网络号。
> * **分析第三字节**：64 = `0100 0000`。
> * /20 覆盖了第三字节的前 4 位（8+8+4=20）。
> * 第三字节的主机位部分是后 4 位（全0到全1）。
> * 块大小 = $2^{8-4} = 2^4 = 16$。
> * 范围起点：64 (`0100 0000`)
> * 范围终点：64 + 16 - 1 = 79 (`0100 1111`)
> * **完整范围**：**222.15.64.0** 到 **222.15.79.255**。
> * 注：题目问的是“地址范围”，通常指整个 CIDR 块的范围。如果要问“可用主机范围”，则应排除首尾。选项 A 包含了首尾，最符合“地址块范围”的定义。

---

### 4.5 填空题

有如下 4 个 /24 地址块, 聚合后的地址为 [填空1] / [填空2]。

**答案**：**212.56.132.0；22**

> **解析：**
> 需要进行**路由聚合 (CIDR Supernetting)**。
> 观察第三个字节：
>
> * `132` = `1000 0100`
> * `133` = `1000 0101`
> * `134` = `1000 0110`
> * `135` = `1000 0111`
>
> 找出共同前缀：前 6 位是相同的 (`1000 01`)。
>
> * 聚合后的前缀长度 = 前两个字节 (8+8) + 第三字节共同部分 (6) = **22**。
> * 聚合后的网络地址 = 保持共同前缀不变，后面补 0  `212.56.132.0`。

---

### 4.6 填空题

一个 3200bit 长的 TCP 报文传到 IP 层，加上 160bit 的首部后成为数据报。下面的互联网由两个局域网通过路由器连接起来。但第二个局域网所能传送的最长数据帧中的数据部分只有 1200bit。因此数据报在路由器必须进行分片。试问需要分成几个片？ [填空1] 第二个局域网向其上层要传送多少比特的数据？ [填空2]

**答案**：**4；3840**

> **解析：**
>
> 1. **计算分片数**：
>
> * 原始数据（Payload）= 3200 bit。
> * 第二个局域网 MTU（最大 IP 分组长度）= 1200 bit。
> * IP 首部 = 160 bit (20 字节)。
> * 每个分片最大数据载荷 = $1200 - 160 = 1040$ bit。
> * **注意**：IP 分片的数据长度必须是 **8 字节 (64 bit) 的倍数**。
> * $1040 / 64 = 16.25$，向下取整为 16。
> * 实际每个分片最大数据载荷 = $16 \times 64 = 1024$ bit。
> * 分片数量 = $\lceil 3200 / 1024 \rceil = 4$ 片（前 3 片 1024 bit，第 4 片 128 bit）。
>
> 2. **计算总传输比特数**：
>
> * 即第二个局域网上传输的所有 IP 分片（首部+数据）的总和，这些数据最终会被目的主机的 IP 层接收并向上传送。
> * 总数据位 = 3200 bit。
> * 总首部位 = $4 \times 160 = 640$ bit。
> * 总比特数 = $3200 + 640 = 3840$ bit。

---

### 4.7 填空题

设 IP 数据报使用固定首部，其各字段的值（十六进制表示）如下表所示... 对其进行反码算术运算求和结果为 0x2CADD，其填入校验和字段的值为 ox [填空1]。

**答案**：**3520**

> **解析：**
> IP 首部校验和的计算步骤如下：
>
> 1. **求和**：将首部划分为多个 16 位的序列进行求和。题目已知反码算术运算求和（累加器中的值）为 `0x2CADD`。
>
> * 由于是 16 位运算，`0x2CADD` 中的高位 `2` 是进位。
> * 需要将进位加回低位：`0xCADD + 0x0002 = 0xCADF`。
>
> 2. **取反**：校验和是和的**反码**（按位取反）。
>
> * `~0xCADF`
> * 二进制：`~ (1100 1010 1101 1111)` = `0011 0101 0010 0000`
> * 十六进制：**`3520`**

---

### 4.8 多选题

当路由器转发一个 IP 数据报时，可能改变首部中的哪些字段。

* A. 版本
* B. 首部长度
* C. 服务类型 (TOS)
* D. 总长度
* E. 标识 (Identification)
* F. 标志 (Flags)
* G. 片偏移 (Fragment Offset)
* H. 生存时间 (TTL)
* I. 协议
* J. 首部校验和
* K. 源 IP 地址
* L. 目的 IP 地址

**答案**：**D, F, G, H, J**

> **解析：**
>
>> 当路由器转发 IP 数据报时：
>>
>
> 1. **必变字段**：
>
> * **H. 生存时间 (TTL)**：每经过一个路由器减 1。
> * **J. 首部校验和**：因为 TTL 变了，校验和必须重新计算。
>
> 2. **可能改变字段**（如果需要**分片**）：
>
> * **D. 总长度**：分片后，每个片的数据量变小。
> * **F. 标志 (Flags)**：MF 位可能被置 1。
> * **G. 片偏移 (Fragment Offset)**：后续分片会有非 0 的偏移量。
>
> 题目问的是“可能改变”，因此应包含分片相关的字段。IP 地址（K, L）在普通路由转发中不变（除非是 NAT，见下题）。

---

### 4.9 单选题

某路由器路由表如下图所示，若路由器收到一个目的地址为 169.96.40.5 的 IP 分组，则转发该 IP 分组的接口是

* A. S0
* B. S1
* C. S3
* D. E0

**答案**：**C**

> **解析：**
>
>> 路由器转发分组时遵循**最长前缀匹配 (Longest Prefix Match)** 原则。
>> 目的 IP：`169.96.40.5`
>>
>
> * **检查 S1 (169.96.40.0/23)**：范围是 40.0 - 41.255。匹配。前缀长度 23。
> * **检查 S2 (169.96.40.0/25)**：范围是 40.0 - 40.127。匹配。前缀长度 25。
> * **检查 S3 (169.96.40.0/27)**：范围是 40.0 - 40.31。匹配（5 在 0-31 之间）。**前缀长度 27**。
> * **检查 S4 (0.0.0.0/0)**：默认路由。匹配。前缀长度 0。
>
> 比较前缀长度：27 > 25 > 23 > 0。因此选择匹配长度最长的 **S3** 接口。

---

### 4.10 单选题

以下命令，哪个使用了 ICMP 的回送请求及回答报文？

* A. Config
* B. Telnet
* C. Tracert
* D. Ping

**答案**：**D**

> **解析：**
>
> * **Ping**：利用 **ICMP Echo Request**（回送请求）和 **ICMP Echo Reply**（回送回答）报文来测试连通性。
> * Tracert (Windows)：主要利用 ICMP 超时报文（Time Exceeded）和回送请求。
> * Telnet：应用层协议，基于 TCP。
> * Config：通常指配置命令（如 ipconfig），不直接发送网络报文。

---

### 4.11 填空题

路由选择算法按其是否具有自适应性，可分为 [填空1] 路由选择策略和 [填空2] 路由选择策略。

**答案**：**静态（或 非自适应）；动态（或 自适应）**

> **解析：**
>
> * **静态路由 (Static Routing)**：由管理员手动配置，不能随网络状况变化而自动调整，属于非自适应。
> * **动态路由 (Dynamic Routing)**：路由器间运行协议自动交换信息，能根据网络拓扑或流量变化自动调整，属于自适应。

---

### 4.12 填空题

路由器的结构可划分为两大部分：[填空1] 部分 (控制层面) 和 [填空2] 部分 (数据层面)。

**答案**：**路由选择；分组转发**

> **解析：**
>
>> 路由器的体系结构通常分为：
>>
>
> 1. **路由选择部分 (Routing selection)**：也称控制层面（Control Plane），负责运行路由协议（如 RIP, OSPF, BGP），计算路由表。
> 2. **分组转发部分 (Packet forwarding)**：也称数据层面（Data Plane），负责根据转发表将进入的分组从合适的端口转发出去（交换结构）。

---

### 4.13 综合题

给出 R2 的路由表，要求包括到达图中所有子网的路由，且路由表中的路由项尽可能少。
![4.13题](https://rain-private-qn.yuketang.cn/slide/43700295/cover1062_20251118095926.jpg?e=1768244419&token=IAM-gs8ue1pDIGwtR1CR0Zjdagg7Q2tn5G_1BqTmhmqa:WRxEiq8YcDBw3m9GpQVQay2TYek=)

**答案**：
**R2 路由表**

| 目的网络 (Destination)     | 下一跳 (Next Hop) | 接口 (Interface) |
| -------------------------- | ----------------- | ---------------- |
| **153.14.5.0/24**    | 153.14.3.2        | S0               |
| **194.17.20.0/23**   | 194.17.24.2       | S1               |
| **194.17.20.128/25** | - (直接交付)      | E0               |

*(注：如果考试要求极其严格，必须列出互连链路网段，可补充 `153.14.3.0/xx` 和 `194.17.24.0/xx` 为直连路由，但通常聚合题主要关注主机所在的子网)*

> **解析：**
> 题目要求“路由项尽可能少”，这意味着我们需要进行**路由聚合 (Route Aggregation/CIDR)**。
> **1. 分析 AS1 方向（向上，通过 S0 接口）**
>
> * 目标子网：`153.14.5.0/25` 和 `153.14.5.128/25`。
> * 二进制计算：
> * `5.0`   -> `00000101.0xxxxxxx`
> * `5.128` -> `00000101.1xxxxxxx`
> * 聚合结果：前 24 位相同，合并为 **`153.14.5.0/24`**。
> * 下一跳：图中 R1 的接口 IP 为 `153.14.3.2`。
>
> **2. 分析 AS2 方向（向下，通过 S1 接口）与 本地 E0**
>
> * 目标子网（在 R3 后）：`194.17.20.0/25` 和 `194.17.21.0/24`。
> * 本地直连子网（在 E0）：`194.17.20.128/25`。
> * **聚合计算**：
> * `20.0`   -> `00010100.0xxxxxxx` (R3)
> * `20.128` -> `00010100.1xxxxxxx` (本地 R2)
> * `21.0`   -> `00010101.xxxxxxxx` (R3)
> * 观察第三字节：`20` (`00010100`) 和 `21` (`00010101`) 的前 7 位相同。
> * 这意味着可以用 **`194.17.20.0/23`** 来覆盖 20.x 和 21.x 的所有地址。
> * **路由策略**：
> * 在路由表中添加一条聚合路由 **`194.17.20.0/23`** 指向 R3（下一跳 `194.17.24.2`）。
> * 同时保留本地直连路由 **`194.17.20.128/25`** 指向 E0。
> * **为什么这样行得通？** 根据**最长前缀匹配 (Longest Prefix Match)** 原则：
> * 去往 `194.17.20.130` (本地) 的包，匹配 /25（更长），走 E0。正确。
> * 去往 `194.17.20.10` (R3) 的包，不匹配 /25，匹配 /23，走 S1。正确。
> * 去往 `194.17.21.5` (R3) 的包，匹配 /23，走 S1。正确。
> * 这样只用 1 条静态路由就能覆盖 AS2 的两个网段，符合“路由项尽可能少”的要求。

---

### 4.14 单选题

某自治系统采用 RIP 协议，若该自治系统内的路由器 R1 收到其邻居路由器 R2 的距离矢量中包含信息 <net1, 16>，则可能得出的结论是

* A. R1 可以经过 R2 到达 net1，距离为 17
* B. R1 可以经过 R2 到达 net1，距离为 16
* C. R2 可以到达 net1，距离为 16
* D. R1 不能经过 R2 到达 net1

**答案**：**D**

> **解析：**
> RIP 协议使用“跳数”（Hop Count）来衡量到达目的网络的距离。
>
> * RIP 规定，一条路径最多包含 15 个路由器。
> * **距离 16 表示不可达**（即无穷大）。
> * 当 R2 告诉 R1 “我到 net1 的距离是 16”时，意味着 R2 自己无法到达 net1。
> * 因此，R1 肯定不能通过 R2 到达 net1（如果硬要算，距离会变成 16+1=17，依然不可达）。

---

### 4.16 填空题

网络如下图所示。假定路由器 R1 要把 H1 发往 128.1.2.16/29 的分组从接口 4 转发出去，而把 H2 发往 128.1.2.16/29 的分组从接口 3 转发出去，可以吗？ [填空1] (可以，不可以)。如果可以，路由器 R1 的转发表中应有网络前缀：[填空2] 和转发接口：[填空3]。如果不可以，填“无”。
![4.16题](https://rain-private-qn.yuketang.cn/slide/43700295/cover1060_20251125100000.jpg?e=1768244369&token=IAM-gs8ue1pDIGwtR1CR0Zjdagg7Q2tn5G_1BqTmhmqa:vGUzZTMIScf1bmtOKg_yt-cO81k=)
**答案**：**不可以；无；无**

> **解析：**
>
> 1. **IP 路由的核心原则**：标准的 IP 路由是**基于目的地址**（Destination-Based Routing）的。路由器只检查数据包头部中的“目的 IP 地址”，并在转发表中查找匹配的条目来决定下一跳。
>
> 2. **本题场景**：H1 和 H2 发送的分组，其**目的地址**都是 H3 所在的网络 `128.1.2.16/29`。
> 3. **冲突**：对于路由器 R1 来说，针对同一个目的网络 `128.1.2.16/29`，转发表中只能有一个最佳匹配的出口（或者在负载均衡/多路径路由时随机/轮询选择，但不能指定“H1 走 A，H2 走 B”）。
> 4. **结论**：普通的路由表无法根据**源地址**（H1 或 H2）来区分转发路径。要实现题目描述的功能，需要使用**策略路由 (Policy-Based Routing, PBR)**，但这是高级特性，不属于标准 IP 路由转发的范畴。因此在常规考题背景下，答案是**不可以**。

---

### 4.17 填空题

将零压缩的 IPv6 地址 123::1:2 写成原来的形式 [填空1]。

**答案**：**0123:0000:0000:0000:0000:0000:0001:0002**

> **解析：**
> IPv6 地址共 128 位，由 8 组 4 位十六进制数组成。
>
> * `::` 代表一连串的 `0`。
> * 现有部分：`123` (第 1 组) 和 `1:2` (最后 2 组)。共 3 组。
> * 缺失部分： 组。
> * 因此 `::` 展开为 5 组 `0000`。
> * 补全前导零：`123`  `0123`，`1`  `0001`，`2`  `0002`。
> * 结果：`0123:0000:0000:0000:0000:0000:0001:0002`。

---

### 4.18 多选题

当 NAT 路由器从专用网向公网转发一个 IP 数据报时，可能改变首部中的哪些字段。

* A. 版本
* B. 首部长度
* C. 服务类型
* D. 总长度
* E. 标识
* F. 标志
* G. 片偏移
* H. 生存时间 (TTL)
* I. 协议
* J. 首部校验和
* K. 源 IP 地址
* L. 目的 IP 地址

**答案**：**H, J, K**

> **解析：**
>
>> NAT（网络地址转换）路由器在转发时：
>>
>
> * **K. 源 IP 地址**：会将专用网（私有）IP 替换为公网 IP。
> * **H. 生存时间 (TTL)**：作为路由器，转发时 TTL 必须减 1。
> * **J. 首部校验和**：IP 地址和 TTL 都变了，校验和必须重算。
> * （注：目的 IP 地址通常在从公网回专用网时改变）。
